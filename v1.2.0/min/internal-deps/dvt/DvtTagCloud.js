/**
 * Copyright (c) 2014, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(['./DvtToolkit'], function(dvt) {
  // Internal use only.  All APIs and functionality are subject to change at any time.
  
  // Map the D namespace to dvt, which is used to provide access across partitions.
  var D = dvt;
  
D.rS=function(a,b,c){this.Init(a,b,c)};(0,D.da)("DvtTagCloud",D.rS);D.A.q(D.rS,D.xj,"DvtTagCloud");D.rS.newInstance=function(a,b,c){return new D.rS(a,b,c)};D.rS.prototype.Init=function(a,b,c){D.rS.u.Init.call(this,a,b,c);this.j().Rc.ya().setAttributeNS(D.o,"text-rendering","geometricPrecision");this.Oa=new D.sS(this,a,this.Yd,this);this.Oa.Ge(this);(0,D.Jf)()||(0,D.Cj)(this.Oa,new D.tS(this.Oa));this.xf=new D.uS;this.jb=[];this.Kq=[];this.Qg=D.o;this.Qd=new D.ou(this.j());(0,D.Sq)(this.Oa,this.Qd)};
D.rS.prototype.W=function(a,b,c){!(0,window.isNaN)(b)&&!(0,window.isNaN)(c)&&(this.Ma=b,this.Xa=c);this.kO();this.Bd(a);this.fb&&this.fb.stop();this.Yg=this.fa;this.uQ=this.jb;this.jb=[];this.Yla=[];this.fa=new D.F(this.j());this.k(this.fa);D.vS.W(this,this.fa,new D.C(0,0,this.Ma,this.Xa));this.pn&&(0,D.Ol)(this.pn,this.G.selection,this.cr());b=this.G.animationDuration;c=new D.C(0,0,this.Ma,this.Xa);this.Yg?"none"!==this.G.animationOnDataChange&&a&&(this.Af=new D.F(this.j()),this.k(this.Af),a=new D.Ym(this.j(),
this.Af),(0,D.Zm)(a,this.uQ,this.jb),this.fb=a.Xq()):"none"!==this.G.animationOnDisplay&&(this.fb=D.kl.my(this.j(),D.kl.Jw,this.fa,c,b));this.fb?(this.Oa.Lc(),this.Oa.Oi(this),this.fb.pe(this.qga,this),this.fb.play()):this.qga();this.fo()};D.rS.prototype.render=D.rS.prototype.W;D.rS.prototype.dda=(0,D.v)("jb");D.rS.prototype.Pf=function(){this.Uk||(this.Uk=new D.wS(this));return this.Uk};D.rS.prototype.getAutomation=D.rS.prototype.Pf;D.rS.prototype.hE=function(a,b){this.Kq.push(a);this.Yla[b]=a};
D.rS.prototype.cr=(0,D.y)("Kq");D.rS.prototype.ri=(0,D.y)("Yla");D.rS.prototype.Ke=function(a){this.G.highlightedCategories=D.vl.ea(a);(0,D.wl)(a,this.cr(),"any"===this.G.highlightMatch);this.Qg&&this.Qg.Ke(a)};D.rS.prototype.highlight=D.rS.prototype.Ke;D.rS.prototype.select=function(a){this.G.selection=D.vl.ea(a);this.pn&&(0,D.Ol)(this.pn,this.G.selection,this.cr())};D.rS.prototype.select=D.rS.prototype.select;D.z=D.rS.prototype;
D.z.Bd=function(a){a?this.G=this.xf.fk(a):this.G||(this.G=(0,D.Ej)(this));a=this.G.selectionMode;this.pn="single"===a?new D.gl("s"):"multiple"===a?new D.gl("m"):D.o;this.Oa.Ku(this.pn);(0,D.fl)()||(this.G.animationOnDisplay="none",this.G.animationOnDataChange="none")};D.z.Uj=function(){return(0,D.uk)(this.v(),"componentName","DvtUtilBundle","TAG_CLOUD")};
D.z.qga=function(){this.Yg&&(this.removeChild(this.Yg),this.Yg.X(),this.Yg=D.o);this.Af&&(this.removeChild(this.Af),this.Af.X(),this.Af=D.o);this.fb&&(this.fb=D.o,this.Oa.Ge(this));this.G.highlightedCategories&&0<this.G.highlightedCategories.length&&this.Ke(this.G.highlightedCategories)};D.z.kO=function(){this.Oa.Lc();this.Kq.length=0};D.z.Ia=(0,D.y)("Oa");
D.z.Yd=function(a,b){var c=a.$a();if(c==D.Cl.Xw||c==D.Cl.az){var d=a.al,e=this.G.hiddenCategories.indexOf(d);c==D.Cl.Xw&&0>e&&this.G.hiddenCategories.push(d);c==D.Cl.az&&0<=e&&this.G.hiddenCategories.splice(e,1);this.W(this.G,this.Ma,this.Xa)}else if("categoryRollOver"==c||"categoryRollOut"==c)this!=b?this.Ke(a.categories):this.Qg&&this.Qg!=b&&this.Qg.Yd(a,b);a&&this.kb(a)};D.z.ju=function(){for(var a=[],b=this.pn.getSelection(),c=0;c<b.length;c++)a=a.concat(b[c].hd());return a};
D.rS.prototype.Oj=function(a,b,c){return this.Qd.Oj(c)};D.rS.prototype.isDragAvailable=D.rS.prototype.Oj;D.rS.prototype.Hk=function(a,b){return this.Qd.Hk(a,b)};D.rS.prototype.getDragTransferable=D.rS.prototype.Hk;D.rS.prototype.ku=function(a,b){return this.Qd.ku(a,b)};D.rS.prototype.getDragOverFeedback=D.rS.prototype.ku;D.rS.prototype.Lp=function(a,b){return this.Qd.Lp(a,b)};D.rS.prototype.getDragContext=D.rS.prototype.Lp;D.rS.prototype.aw=function(a,b){return this.Qd.aw(a,b)};
D.rS.prototype.getDragOffset=D.rS.prototype.aw;D.rS.prototype.hw=function(a,b){return this.Qd.hw(a,b)};D.rS.prototype.getPointerOffset=D.rS.prototype.hw;D.rS.prototype.mw=function(){this.Qd.mw()};D.rS.prototype.initiateDrag=D.rS.prototype.mw;D.rS.prototype.os=function(){this.Qd.os()};D.rS.prototype.dragDropEnd=D.rS.prototype.os;
D.rS.prototype.Co=function(a,b,c){this.Ll||(this.Ll=new D.zS);return this.Ll.Co(a,b,c)};D.rS.prototype.acceptDrag=D.rS.prototype.Co;
D.wS=(0,D.v)("$x");(0,D.da)("DvtTagCloudAutomation",D.wS);D.A.q(D.wS,D.Ij,"DvtTagCloudAutomation");D.wS.prototype.Dl=function(a){return(a=(0,D.Jj)(this.$x.Oa,a))&&a instanceof D.xS?"item["+this.$x.ri().indexOf(a)+"]":D.o};D.wS.prototype.Qf=function(a){if("tooltip"==a)return(0,D.hm)(this.$x);var b=a.indexOf("[");return 0<b&&"item"===a.substring(0,b)&&(a=(0,window.parseInt)(a.substring(b+1,a.length-1)),a=this.$x.ri()[a])?a.hd()[0].ya():D.o};D.wS.prototype.getDomElementForSubId=D.wS.prototype.Qf;
D.wS.prototype.getItem=function(a){if(a=this.$x.ri()[a]){var b={};b.color=a.Ki();b.tooltip=a.Kc();b.label=a.Yc();b.value=a.getValue();b.selected=a.Ga();return b}return D.o};D.wS.prototype.getItem=D.wS.prototype.getItem;D.wS.prototype.lM=function(){return this.$x.cr().length};D.wS.prototype.getItemCount=D.wS.prototype.lM;
D.BS=function(a,b,c,d,e,f,g){this.Init(a,b,c,d,e,f,g)};D.A.q(D.BS,D.hk,"DvtTagCloudItem");D.z=D.BS.prototype;D.z.Init=function(a,b,c,d,e,f,g){D.BS.u.Init.call(this,b,c,d,e,f,g);this.$x=a;f&&(0,D.CS)(this,f)};D.z.F1=function(a,b){this.HZ();return D.BS.u.F1.call(this,a,b)};D.z.qb=function(a){this.gi!=a&&((this.gi=a)?this.Pl?this.Na(this.iX):this.Na(this.PY):this.Na(this.qG))};D.z.Xb=function(){this.Pl||(this.Pl=D.k,this.gi?this.Na(this.iX):this.Na(this.l7))};
D.z.Mb=function(){this.gi?this.Na(this.PY):this.Na(this.qG);this.Pl=D.p};
D.z.hf=function(a,b){var c=new D.vn(this.j(),this,D.DS.Ca(this.$x)),d=this.pc(),e=b.pc(),f=D.p,g=e.C("color"),h=d.C("color");if(g!=h){var j=this;this.Na(d.ca("color",g));(0,D.T)(c.O,"typeColor",this,function(){return j.pc().C("color")},function(a){j.Na(j.pc().ca("color",a))},h)}e=(0,window.parseFloat)(e.C("font-size"));d=(0,window.parseFloat)(d.C("font-size"));e!=d&&(f=D.k,j=this,this.Me(e),(0,D.T)(c.O,"typeNumber",this,function(){return(0,window.parseFloat)(j.pc().C("font-size"))},this.Me,d));g=
b.qa();d=this.qa();e=b.Nn();h=this.Nn();if(d!=g||f&&h!=e)h!=e&&(f=g,g=b.ee.I(D.i),g="left"==e?f+g.e:"right"==e?f-g.e:f),this.ka(g),(0,D.T)(c.O,"typeNumber",this,this.qa,this.ka,d);f=b.sa();d=this.sa();d!=f&&(this.Aa(f),(0,D.T)(c.O,"typeNumber",this,this.sa,this.Aa,d));b.D(0);a.add(c,1)};D.z.vh=function(a){a.add(new D.xn(this.j(),this,D.DS.Ca(this.$x)),0)};D.z.yg=function(a){this.D(0);a.add(new D.an(this.j(),this,D.DS.Ca(this.$x)),2)};D.z.Me=function(a){D.BS.u.Me.call(this,a);(0,D.CS)(this,this.pc())};
D.CS=function(a,b){a.qG=b.ea();var c=a.qG.C("color");a.qG.ca("background-color",D.o);a.l7=a.qG.ea();var d=(0,D.ES)(c,0.3);a.l7.ca("background-color",d);a.l7.ca("color",D.J.Ij(d));a.PY=a.qG.ea();a.PY.ca("background-color",c);a.PY.ca("color",D.J.Ij(c));a.iX=a.qG.ea();c=(0,D.ES)(c,0.6);a.iX.ca("background-color",c);a.iX.ca("color",D.J.Ij(c))};
D.ES=function(a,b){var c=D.J.ze(a),d=D.J.xe(a),e=D.J.we(a);return D.J.fB(window.Math.floor(255*(1-b)+b*c),window.Math.floor(255*(1-b)+b*d),window.Math.floor(255*(1-b)+b*e))};
D.xS=function(a,b,c){this.Init(a,b,c)};D.A.q(D.xS,D.A,"DvtTagCloudObjPeer");D.z=D.xS.prototype;D.z.Init=function(a,b,c){this.K=a;this.Dg=b;this.wa=c;this.kF=this.gi=D.p;c.url?(b.kd("link"),this.g8=D.E.FD("_blank",c.url)):b.kd("img");this.Qq()};D.z.getId=function(){return this.wa.id};D.z.Yc=function(){return this.wa.label};D.z.getValue=function(){return this.wa.value};D.z.Kc=function(){return this.wa.shortDesc};D.z.He=function(){return this.wa.action};
D.z.Ie=function(){var a=this.K.v().tooltip;return a?(0,D.op)(this.K.j().cd(),a,this.$v()):this.Kc()};D.z.$v=function(){return{id:this.getId(),label:this.Yc(),color:this.Ki(),value:this.getValue()}};D.z.FD=(0,D.y)("g8");D.z.Ki=function(){this.oo||(this.oo=(new D.I(this.wa.style)).C("color"));return this.oo};D.z.Sf=(0,D.v)("kF");D.z.Ea=(0,D.y)("kF");D.z.Ga=(0,D.y)("gi");D.z.qb=function(a){this.gi=a;this.Dg.qb(a);this.Qq()};D.z.Xb=function(){this.Dg.Xb()};D.z.Mb=function(){this.Dg.Mb()};
D.z.Vd=function(a){var b=this.K.Oa.$f;a.type==D.rk||b.hr(a)?a=this:b.Bg(a)?(b=this.K.cr(),a=b.indexOf(this)+(39==a.keyCode||40==a.keyCode?1:-1),a=a<b.length&&0<=a?b[a]:D.o):a=D.o;return a};D.z.Je=function(a){return this.Dg.I(a)};D.z.Nj=function(){return this.Dg.ya()};D.z.ce=function(){this.Sb=D.k;this.Xb()};D.z.sc=function(){this.Sb&&(this.Sb=D.p,this.Mb())};D.z.xc=(0,D.y)("Sb");D.z.hd=function(){return[this.Dg]};
D.z.oc=function(){var a=[];this.Ea()&&a.push((0,D.N)("DvtUtilBundle",this.Ga()?"STATE_SELECTED":"STATE_UNSELECTED"));return(0,D.vk)(this.Kc(),a)};D.z.Tc=function(){return this.wa.categories};D.z.Qq=function(){(0,D.af)()||this.Dg.Rb("label",this.oc())};D.z.Jd=function(){if(!this.xd&&(this.xd=[],this.wa.showPopupBehaviors))for(var a=this.wa.showPopupBehaviors,b=0;b<a.length;b++)this.xd.push(new D.Ki(a[b].popupId,a[b].triggerType,a[b].alignId,a[b].align));return this.xd};
D.z.Oj=function(a){return this.K.pn?a[0]:D.o};D.z.Hk=function(){var a=this.K;this.Ga()||(a.pn.bn(this,D.p),a.Oa.Zv());for(var b=[],a=a.pn.getSelection(),c=0;c<a.length;c++){var d=a[c];d instanceof D.xS&&b.push(d.getId())}return b};D.z.ju=function(){return this.K.ju()};
D.uS=function(){this.Init({alta:D.yS})};D.A.q(D.uS,D.Sj,"DvtTagCloudDefaults");
D.yS={animationOnDisplay:"none",animationOnDataChange:"none",emptyText:D.o,hiddenCategories:[],hideAndShowBehavior:"none",highlightedCategories:[],highlightMatch:"all",hoverBehavior:"none",layout:"rectangular",selectionMode:"none",_statusMessageStyle:new D.I('font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: #333333;'),styleDefaults:{animationDuration:500,hoverBehaviorDelay:200,style:new D.I('font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: #333333;')},touchResponse:"auto"};
D.vS={};D.A.q(D.vS,D.A,"DvtTagCloudRenderer");D.vS.W=function(a,b,c){D.vS.Ut(a,b,c);D.vS.gD(a,b,c);D.vS.hx(c);var d=a.v();d.items&&0<d.items.length?(d=D.vS.A9(a,b,c),0<d.length?(a.dda(d),(0,D.Gj)(a.Oa,a.cr()[0])):D.vS.XQ(a,b,c)):D.vS.XQ(a,b,c)};D.vS.XQ=function(a,b,c){var d=a.v(),e=d.emptyText;e||(e=(0,D.uk)(d,"labelNoData","DvtUtilBundle","NO_DATA",D.o));D.Ye.cn(b,e,new D.C(c.x,c.y,c.e,c.g),a.Oa,d._statusMessageStyle)};D.vS.Ut=function(a,b,c){a=new D.Re(a.j(),c.x,c.y,c.e,c.g);(0,D.Ai)(a);b.k(a)};
D.vS.A9=function(a,b,c){for(var d=a.v(),e=[],f=d.items,g=window.Number.MAX_VALUE,h=-window.Number.MAX_VALUE,j=0;j<f.length;j++)g=window.Math.min(g,f[j].value),h=window.Math.max(h,f[j].value);g=D.FS.JJa(g,h);h=D.$f.kH(d.hiddenCategories);for(j=0;j<f.length;j++){var l=f[j];l.categories||(l.categories=[l.label]);if(!h||!D.$f.HM(h,l.categories)){var m=d.styleDefaults.style.ea();(0,D.Vf)(m,l.style);m.ca("font-size",g.call(D.o,l.value).toString());var m=new D.BS(a,a.j(),l.label,0,0,m,l.id),n=new D.xS(a,
m,l);a.Oa.La(m,n);a.hE(n,j);"none"!==d.selectionMode&&n.Sf(D.k);(n.Ea()||l.url||n.He())&&m.setCursor("pointer");e.push(m);b.k(m)}}0<e.length&&("cloud"===d.layout?D.FS.SHa(c,e):D.FS.GNa(c,e,(0,D.G)(a.j())));return e};
D.vS.gD=function(a,b,c){var d=a.v(),e=d.legend;if(e&&e.sections){e=D.vl.ea(e);e.orientation="horizontal";e.halign="center";e.hoverBehavior=d.hoverBehavior;e.hideAndShowBehavior=d.hideAndShowBehavior;e.hiddenCategories=d.hiddenCategories;d=(0,D.Hn)(a.j(),a.Yd,a);b.k(d);var f=d.Pp(e,c.e,c.g/3);d.W(e,f.e,f.g);(0,D.Fn)(c,"bottom",d,f.e,f.g,0);a.Qg&&(a.Qg.X(),b.removeChild(a.Qg));a.Qg=d}};D.vS.hx=function(a){a.x=window.Math.round(a.x);a.y=window.Math.round(a.y);a.e=window.Math.round(a.e);a.g=window.Math.round(a.g)};
D.FS=(0,D.t)();D.A.q(D.FS,D.A,"DvtTagCloudLayoutUtils");D.FS.JJa=function(a,b){return function(c){return 12+window.Math.ceil(12*(2*(c-a)/(b-a)))}};
D.FS.SHa=function(a,b){var c=[],d=10/180,e=10/180;a.e>a.g?d*=a.e/a.g:e*=a.g/a.e;for(var f=2*window.Math.PI/180,g=D.o,h=0,j=[],l=[],m=0;m<b.length;m++)for(var n=D.p,q=0,r=4,s=b[m],u=s.I(),h=window.Math.max(h,(0,window.parseFloat)(s.pc().C("font-size"))),w=-1;!n;){var x=q%180;j[x]===D.i&&(j[x]=window.Math.cos(q*f));l[x]===D.i&&(l[x]=window.Math.sin(q*f));var D$=d*q*j[x],Q=e*q*l[x],M=new D.C(D$,Q,u.e,u.g),n=D.k;-1!=w&&c[w].g0(M)&&(n=D.p);if(n)for(x=0;x<m;x++)if(c[x].g0(M)){w=x;n=D.p;break}n&&(g=g?(0,D.Go)(g,
M):M,w=-1,c[m]=M,s.ka(D$),s.Aa(-u.y+Q));3600===q?r=3:5400===q?r=2:10800===q&&(r=1);q+=r}c=window.Math.max(g.e/a.e,g.g/a.g);d=g.x+g.e/2;g=g.y+g.g/2;for(x=0;x<b.length;x++)s=b[x],s.ka(a.x+s.qa()/c+(a.e/2-d/c)),s.Aa(a.y+s.sa()/c+(a.g/2-g/c)),e=(0,window.parseFloat)(s.pc().C("font-size")),s.Me(e/c)};
D.FS.GNa=function(a,b,c){for(var d=[],e=0,f=0,g=0,h=0;h<b.length;h++){var j=b[h],l=j.I(),e=window.Math.max(e,l.e),f=window.Math.max(f,l.g),g=window.Math.max(g,(0,window.parseFloat)(j.pc().C("font-size")));d.push(new D.Eg(l.e,l.g))}h=0;for(j=(a.e-10)/e;0.001<j-h;)e=(h+j)/2,g=D.FS.bja(d,(a.e-10)/e),g.length*(e*f+2)-2>a.g-10?j=e:h=e;e=h;g=D.FS.bja(d,(a.e-10)/e);g.push(b.length);for(h=0;h<g.length-1;h++){var l=g[h],m=g[h+1],n=0,q=0,r=D.k;if(1<m-l){for(var j=0,s=l;s<m;s++)j+=d[s].e*e,q=window.Math.max(q,
d[s].g*e);n=(a.e-10-j)/(m-l-1);h==g.length-2&&(s=0.5*q,s<n&&j+(m-l)*s<0.9*(a.e-10)&&(n=s,r=D.p))}for(var q=5+(h+1)*(f*e+2)-2,u=c?a.e-5:5,s=l;s<m;s++){var j=b[s],w=(0,window.parseFloat)(j.pc().C("font-size"));j.Me(w*e);j.Aa(a.y+q);r&&s==m-1&&s!=l?c?(j.Lh(),j.ka(a.x+5)):(j.Mh(),j.ka(a.x+a.e-5)):(j.ka(a.x+u),c?(j.Mh(),u-=d[s].e*e+n):(j.Lh(),u+=d[s].e*e+n))}}};D.FS.bja=function(a,b){var c=[0],d=a[0].e+2;if(1<a.length)for(var e=1;e<a.length;e++)d+a[e].e>b&&(c.push(e),d=0),d+=a[e].e+2;return c};
D.DS={};D.A.q(D.DS,D.A,"DvtTagCloudStyleUtils");D.DS.Ca=function(a){return a.v().styleDefaults.animationDuration/1E3};
D.sS=function(a,b,c,d){this.Init(b,c,d);this.K=a};D.A.q(D.sS,D.Uj,"DvtTagCloudEventManager");D.sS.prototype.QI=function(a){a=(0,D.Jj)(this,a.target);(0,D.AS)(a);this.LG(a)};D.sS.prototype.LN=function(a){a=(0,D.Jj)(this,a.target);this.LG(a)};D.sS.prototype.zr=function(a){a=(0,D.Jj)(this,a.target);(0,D.AS)(a);this.LG(a)};D.AS=function(a){a instanceof D.xS&&(a=a.FD())&&a.call()};D.sS.prototype.Xh=function(a){var b=D.k,c=this.od();13==a.keyCode?(0,D.AS)(c):b=D.sS.u.Xh.call(this,a);return b};
D.sS.prototype.tm=function(a,b,c){a=this.K.v();"dim"==a.hoverBehavior&&(b=b.Tc?b.Tc():[],a.highlightedCategories=c?b.slice():D.o,c=new D.Fm(c?"categoryRollOver":"categoryRollOut",a.highlightedCategories),b=(0,D.np)(a.styleDefaults.hoverBehaviorDelay),this.LB.Yd(c,this.K.cr(),b,"any"==a.highlightMatch))};D.sS.prototype.LG=function(a){a&&(a.He&&a.He())&&this.jh(new D.Xj("action",a.He(),a.getId()))};D.sS.prototype.Pu=function(){return this.K.v().touchResponse};
D.tS=function(a){this.Init(a)};D.A.q(D.tS,D.qk,"DvtTagCloudKeyboardHandler");D.tS.prototype.Init=function(a){D.tS.u.Init.call(this,a)};D.tS.prototype.By=function(a){return this.Bg(a)&&!a.ctrlKey};D.tS.prototype.hr=function(a){return 32==a.keyCode&&a.ctrlKey};
D.zS=(0,D.t)();D.A.q(D.zS,D.qu,"DvtTagCloudDropTarget");D.zS.prototype.Co=function(a,b,c){return c[0]};

  return D;
});